<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FixRight Admin - AI Provider Configuration</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    .header {
      background: white;
      padding: 30px;
      border-radius: 12px;
      margin-bottom: 30px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    }

    .header h1 {
      color: #333;
      margin-bottom: 10px;
    }

    .header p {
      color: #666;
      font-size: 14px;
    }

    .main-content {
      display: grid;
      grid-template-columns: 1fr 1.2fr;
      gap: 30px;
    }

    @media (max-width: 768px) {
      .main-content {
        grid-template-columns: 1fr;
      }
    }

    .panel {
      background: white;
      border-radius: 12px;
      padding: 30px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    }

    .panel h2 {
      color: #333;
      margin-bottom: 20px;
      font-size: 20px;
      border-bottom: 2px solid #667eea;
      padding-bottom: 10px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      color: #333;
      margin-bottom: 8px;
      font-weight: 500;
      font-size: 14px;
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 14px;
      font-family: inherit;
      transition: border-color 0.3s;
    }

    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .form-group textarea {
      resize: vertical;
      min-height: 80px;
    }

    .button-group {
      display: flex;
      gap: 10px;
      margin-top: 25px;
    }

    button {
      flex: 1;
      padding: 12px 20px;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }

    .btn-primary {
      background: #667eea;
      color: white;
    }

    .btn-primary:hover {
      background: #5568d3;
      transform: translateY(-2px);
      box-shadow: 0 8px 16px rgba(102, 126, 234, 0.3);
    }

    .btn-secondary {
      background: #f0f0f0;
      color: #333;
    }

    .btn-secondary:hover {
      background: #e0e0e0;
    }

    .provider-card {
      background: #f9f9f9;
      border: 1px solid #eee;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 15px;
      transition: all 0.3s;
    }

    .provider-card:hover {
      border-color: #667eea;
      box-shadow: 0 2px 8px rgba(102, 126, 234, 0.15);
    }

    .provider-card h3 {
      color: #333;
      font-size: 16px;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .provider-badge {
      display: inline-block;
      padding: 4px 12px;
      background: #667eea;
      color: white;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
    }

    .provider-badge.disabled {
      background: #ccc;
    }

    .provider-info {
      color: #666;
      font-size: 13px;
      margin-bottom: 12px;
      line-height: 1.5;
    }

    .provider-info strong {
      color: #333;
    }

    .provider-actions {
      display: flex;
      gap: 8px;
    }

    .provider-actions button {
      flex: 1;
      padding: 8px 12px;
      font-size: 12px;
    }

    .btn-small {
      padding: 8px 12px;
      font-size: 12px;
    }

    .btn-danger {
      background: #ff4757;
      color: white;
    }

    .btn-danger:hover {
      background: #ff3838;
    }

    .btn-success {
      background: #2ed573;
      color: white;
    }

    .btn-success:hover {
      background: #26de81;
    }

    .btn-warning {
      background: #ffa502;
      color: white;
    }

    .btn-warning:hover {
      background: #ff8c00;
    }

    .alert {
      padding: 12px 16px;
      border-radius: 6px;
      margin-bottom: 15px;
      font-size: 14px;
    }

    .alert-success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    .alert-error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }

    .alert-info {
      background: #d1ecf1;
      color: #0c5460;
      border: 1px solid #bee5eb;
    }

    .empty-state {
      text-align: center;
      color: #999;
      padding: 40px 20px;
    }

    .empty-state-icon {
      font-size: 48px;
      margin-bottom: 16px;
    }

    .model-hint {
      font-size: 12px;
      color: #999;
      margin-top: 4px;
    }

    .instructions {
      background: #f0f8ff;
      border-left: 4px solid #667eea;
      padding: 12px;
      border-radius: 4px;
      font-size: 13px;
      color: #333;
      margin-bottom: 20px;
      line-height: 1.6;
    }

    .status-indicator {
      display: inline-block;
      width: 8px;
      height: 8px;
      border-radius: 50%;
      margin-right: 6px;
    }

    .status-indicator.active {
      background: #2ed573;
    }

    .status-indicator.inactive {
      background: #ccc;
    }

    .loading {
      text-align: center;
      padding: 20px;
      color: #999;
    }

    .spinner {
      border: 3px solid #f3f3f3;
      border-top: 3px solid #667eea;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      animation: spin 1s linear infinite;
      display: inline-block;
      margin-right: 10px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üöÄ FixRight Admin Panel</h1>
      <p>Configure AI providers for your marketplace chatbot</p>
    </div>

    <div class="main-content">
      <!-- Add Provider Form -->
      <div class="panel">
        <h2>‚ûï Add AI Provider</h2>
        <div class="instructions">
          <strong>Quick Setup:</strong> Select a provider type, fill in your API details, and click Save.
        </div>

        <form id="providerForm">
          <div class="form-group">
            <label for="providerType">Provider Type *</label>
            <select id="providerType" required onchange="updateModelHint()">
              <option value="">-- Select a provider --</option>
              <option value="openai">OpenAI (GPT-4, GPT-3.5)</option>
              <option value="claude">Anthropic Claude</option>
              <option value="gemini">Google Gemini</option>
              <option value="deepseek">DeepSeek</option>
              <option value="custom">Custom Provider</option>
            </select>
          </div>

          <div class="form-group">
            <label for="providerName">Display Name *</label>
            <input type="text" id="providerName" placeholder="e.g., GPT-4 Production" required>
          </div>

          <div class="form-group">
            <label for="apiEndpoint">API Endpoint *</label>
            <input type="url" id="apiEndpoint" placeholder="https://api.example.com/v1/endpoint" required>
            <div class="model-hint" id="endpointHint"></div>
          </div>

          <div class="form-group">
            <label for="apiKey">API Key *</label>
            <input type="password" id="apiKey" placeholder="Your secret API key" required>
          </div>

          <div class="form-group">
            <label for="modelId">Model ID</label>
            <input type="text" id="modelId" placeholder="e.g., gpt-4, claude-3-opus">
            <div class="model-hint" id="modelHint"></div>
          </div>

          <div class="button-group">
            <button type="submit" class="btn-primary">üíæ Save Provider</button>
            <button type="reset" class="btn-secondary">üîÑ Clear</button>
          </div>
        </form>
      </div>

      <!-- Providers List -->
      <div class="panel">
        <h2>üéØ Active Providers</h2>
        <div id="alertContainer"></div>
        <div id="providersList" class="empty-state">
          <div class="spinner" style="display:inline-block;"></div>
          Loading providers...
        </div>
      </div>
    </div>
  </div>

  <script>
    // Configuration UI - Updated to use API
    const API_BASE = 'http://localhost:5000'; // Change to your backend URL

    const PROVIDER_HINTS = {
      openai: {
        endpoint: 'https://api.openai.com/v1/chat/completions',
        model: 'gpt-4 or gpt-3.5-turbo',
        keyFormat: 'sk-...',
      },
      claude: {
        endpoint: 'https://api.anthropic.com/v1/messages',
        model: 'claude-3-opus-20240229',
        keyFormat: 'sk-ant-...',
      },
      gemini: {
        endpoint: 'https://generativelanguage.googleapis.com/v1beta/models/{model}:generateContent',
        model: 'gemini-pro',
        keyFormat: 'AIzaSy-...',
      },
      deepseek: {
        endpoint: 'https://api.deepseek.com/chat/completions',
        model: 'deepseek-chat',
        keyFormat: 'sk-...',
      },
      custom: {
        endpoint: 'https://your-server.com/v1/endpoint',
        model: 'your-model-id',
        keyFormat: 'your-api-key',
      },
    };

    // Update endpoint hint based on provider type
    function updateModelHint() {
      const type = document.getElementById('providerType').value;
      const hint = PROVIDER_HINTS[type];
      if (hint) {
        document.getElementById('endpointHint').textContent = `Example: ${hint.endpoint}`;
        document.getElementById('modelHint').textContent = `e.g., ${hint.model}`;
      }
    }

    // Show alert message
    function showAlert(message, type = 'info') {
      const container = document.getElementById('alertContainer');
      const alert = document.createElement('div');
      alert.className = `alert alert-${type}`;
      alert.textContent = message;
      container.innerHTML = '';
      container.appendChild(alert);
      setTimeout(() => alert.remove(), 4000);
    }

    // Save provider to Firebase via API
    document.getElementById('providerForm').addEventListener('submit', async (e) => {
      e.preventDefault();

      const provider = {
        type: document.getElementById('providerType').value,
        name: document.getElementById('providerName').value,
        apiEndpoint: document.getElementById('apiEndpoint').value,
        apiKey: document.getElementById('apiKey').value,
        model: document.getElementById('modelId').value || null,
      };

      try {
        const response = await fetch(`${API_BASE}/api/providers`, {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify(provider),
        });

        if (!response.ok) {
          const error = await response.json();
          throw new Error(error.error || 'Failed to save provider');
        }

        showAlert('‚úì Provider saved successfully!', 'success');
        document.getElementById('providerForm').reset();
        loadProviders();
      } catch (e) {
        console.error('Error:', e);
        showAlert(`‚ùå Error: ${e.message}`, 'error');
      }
    });

    // Load and display providers from Firebase
    async function loadProviders() {
      const container = document.getElementById('providersList');
      
      try {
        const response = await fetch(`${API_BASE}/api/providers`);
        if (!response.ok) throw new Error('Failed to load providers');
        
        const providers = await response.json();

        if (providers.length === 0) {
          container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üì≠</div><p>No providers configured yet. Add one to get started!</p></div>';
          return;
        }

        container.innerHTML = providers.map((p) => `
          <div class="provider-card">
            <h3>
              <span class="status-indicator ${p.enabled ? 'active' : 'inactive'}"></span>
              ${p.name}
              <span class="provider-badge ${p.enabled ? '' : 'disabled'}">${p.type.toUpperCase()}</span>
            </h3>
            <div class="provider-info">
              <div><strong>Endpoint:</strong> ${p.apiEndpoint}</div>
              <div><strong>Model:</strong> ${p.model || 'N/A'}</div>
              <div><strong>Status:</strong> ${p.enabled ? '‚úì Enabled' : '‚úó Disabled'}</div>
            </div>
            <div class="provider-actions">
              <button class="btn-small btn-warning" onclick="editProvider('${p.id}')">‚úèÔ∏è Edit</button>
              <button class="btn-small btn-success" onclick="setDefault('${p.id}')">‚≠ê Default</button>
              <button class="btn-small btn-danger" onclick="deleteProvider('${p.id}')">üóëÔ∏è Delete</button>
            </div>
          </div>
        `).join('');
      } catch (e) {
        console.error('Error loading providers:', e);
        container.innerHTML = '<div class="alert alert-error">Failed to load providers. Check console for details.</div>';
      }
    }

    // Delete provider
    async function deleteProvider(id) {
      if (confirm('Are you sure you want to delete this provider?')) {
        try {
          const response = await fetch(`${API_BASE}/api/providers/${id}`, {method: 'DELETE'});
          if (!response.ok) throw new Error('Failed to delete');
          showAlert('Provider deleted', 'success');
          loadProviders();
        } catch (e) {
          showAlert(`Error: ${e.message}`, 'error');
        }
      }
    }

    // Set as default
    async function setDefault(id) {
      try {
        const response = await fetch(`${API_BASE}/api/config/default-provider`, {
          method: 'PUT',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({providerId: id}),
        });
        if (!response.ok) throw new Error('Failed to set default');
        showAlert('Default provider updated ‚≠ê', 'success');
        loadProviders();
      } catch (e) {
        showAlert(`Error: ${e.message}`, 'error');
      }
    }

    // Edit provider (placeholder)
    function editProvider(id) {
      showAlert('Edit feature coming soon! Delete and re-add to modify.', 'info');
    }

    // Initial load
    loadProviders();
    </script>
</body>
</html>
